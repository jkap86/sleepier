"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.instrument = exports.PLUGIN_NAME = void 0;
const tslib_1 = require("tslib");
const shimmer_1 = tslib_1.__importDefault(require("shimmer"));
const incoming_1 = require("./lifecycle/incoming");
const outgoing_1 = require("./lifecycle/outgoing");
exports.PLUGIN_NAME = "https";
const instrument = (mod, tracer) => ({
    version: ">= 10",
    install() {
        var _a;
        // wrap incoming requests
        if ((_a = mod === null || mod === void 0 ? void 0 : mod.Server) === null || _a === void 0 ? void 0 : _a.prototype) {
            shimmer_1.default.wrap(mod.Server.prototype, "emit", incoming_1.getPatchIncomingRequestFunction(tracer));
        }
        // wrap outgoing requests
        shimmer_1.default.wrap(mod, "request", outgoing_1.getPatchOutgoingRequestFunction(tracer));
        shimmer_1.default.wrap(mod, "get", outgoing_1.getPatchOutgoingGetFunction(mod.request));
        return mod;
    },
    uninstall() {
        var _a;
        // unwrap incoming requests
        if ((_a = mod === null || mod === void 0 ? void 0 : mod.Server) === null || _a === void 0 ? void 0 : _a.prototype) {
            shimmer_1.default.unwrap(mod.Server.prototype, "emit");
        }
        // unwrap outgoing requests
        shimmer_1.default.unwrap(mod, "request");
        shimmer_1.default.unwrap(mod, "get");
    }
});
exports.instrument = instrument;
